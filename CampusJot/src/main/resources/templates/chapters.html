<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title th:text="'CampusJot - ' + ${subjectName}">CampusJot -
	Repo</title>
<link rel="stylesheet" th:href="@{/css/style.css}">
</head>
<body>
	<div class="container">
		<aside class="sidebar">
			<a th:href="@{/home}" class="logo">CampusJot</a>
			<nav>
				<ul class="menu">
					<li><a th:href="@{/home}" class="active">Folders</a></li>
					<li><a th:href="@{/groups}">Groups</a></li>
				</ul>
			</nav>
		</aside>


		<!-- Attch the alert box on file upload success -->


		<div class="main-content">
			<header class="top-bar">
				<div class="repo-header">
					<h2 class="repo-name" th:text="${group} + ' / ' + ${subjectName}" />
				</div>
				<div class="user-box">
					<span class="username" th:text="${session.username}">user123</span>
					<a th:href="@{/logout}" class="logout-btn">Log out</a>
				</div>
			</header>


			<div class="top-buttons"
				style="align-self: flex-end; margin-top: -30px; margin-bottom: 20px;">
				<a href="#upload-popup" class="create-btn">Upload notes</a> <a
					href="#create-popup" class="create-btn">Create Note File</a>
			</div>

			<div id="upload-popup" class="popup">
				<div class="popup-content">
					<a href="#" class="close">&times;</a>
					<h2>Upload File</h2>

					<form th:action="@{/subject/{subid}/upload(subid=${sid})}"
						method="post" enctype="multipart/form-data">

						<input type="file" name="file" required
							style="margin-bottom: 15px;">

						<button type="submit" class="popup-btn">Upload</button>
					</form>
				</div>
			</div>

			<table>
				<thead>
					<tr>
						<th>Name</th>
						<th>Actions</th>
					</tr>
				</thead>
				<tbody>
					<tr th:each="doc : ${documents}">

						<td th:text="${doc.fileName}">placeholder_file.txt</td>

						<td style="display: flex; gap: 8px; align-items: center;">
							<div class="action-buttons">
								<a th:href="@{/documents/edit/{id}(id=${doc.id})}"
									class="open-btn">Edit</a>

								<form th:action="@{/document/delete}" method="post">
									<input type="hidden" name="documentId" th:value="${doc.id}" />
									<button type="submit" class="open-btn">Delete</button>
								</form>
							</div>
						</td>

					</tr>
				</tbody>
			</table>
		</div>
	</div>


	<div id="create-popup" class="popup">
		<div class="popup-content">
			<a href="#" class="close">&times;</a>
			<h3 style="text-align: left; margin-bottom: 10px;">Create New
				Note File</h3>

			<form
				th:action="@{/subjects/{subjectId}/createnote(subjectId=${sid})}"
				method="post">

				<input type="text" name="fileName" placeholder="Linear Algebra"
					required>

				<button type="submit" class="popup-btn">Create</button>
			</form>
		</div>
	</div>

	<div id="download-msg" class="download-msg">
		<span>⬇️ Download Started, if not click again on Download
			Button</span>
	</div>

	<script>
    // This script remains the same as it has no server-side dependency
    document.querySelectorAll(".download-btn").forEach(btn => {
      btn.addEventListener("click", () => {
        let msg = document.getElementById("download-msg");
        msg.classList.add("show");
        setTimeout(() => {
          msg.classList.remove("show");
        }, 4000);
      });
    });
  </script>
</body>
</html>